"use strict";function createChord(){function e(e){switch(e){case"PTI":return'<img src="./resources/partylogos/bat.svg"></img>';case"PML-N":return'<img src="./resources/partylogos/tiger.svg"></img>';case"MQM":return'<img src="./resources/partylogos/kite.svg"></img>';case"PPPP":return'<img style="transform: rotate(45deg);" src="./resources/partylogos/arrow.svg"></img>';case"APML":return'<img src="./resources/partylogos/eagle.svg"></img>';case"PML":return'<img src="./resources/partylogos/bicycle.svg"></img>';case"PML-F":return'<img src="./resources/partylogos/rose.svg"></img>';case"JUI-F":return'<img style="width: 100%;" src="./resources/partylogos/book.svg"></img>';case"JI":return'<img style="width: 100%;" src="./resources/partylogos/balance.svg"></img>';case"PML-Z":return'<img style="width: 100%;" src="./resources/partylogos/helicopter.svg"></img>';case"Ind.":return'<img style="width: 100%;" src="./resources/partylogos/ind.png"></img>';default:return'<img style="width: 90%;" src="./resources/ballot1.svg"></img>'}}function t(e){switch(e){case"Pakistan Tehreek-e-Insaf":return"PTI";case"Jamiat Ulama-e-Islam (F)":return"JUI-F";case"Qaumi Watan Party (Sherpao)":return"QWP-S";case"Awami National Party":return"ANP";case"Awami Jamhuri Ittehad Pakistan":return"AJIP";case"Pakistan Muslim League (N)":return"PML-N";case"Independent":return"Ind.";case"Jamaat-e-Islami Pakistan":return"JI";case"All Pakistan Muslim League":return"APML";case"Awami Muslim League Pakistan":return"AMLP";case"Pakistan Muslim League":return"PML";case"Pakistan Muslim League(Z)":return"PML-Z";case"Pakistan Peoples Party Parliamentarians":return"PPPP";case"National Peoples Party":return"NPP";case"Pakistan Muslim League (F)":return"PML-F";case"Muttahida Qaumi Movement Pakistan":return"MQM";case"Pashtoonkhwa Milli Awami Party":return"PMAP";case"National Party":return"NP";case"Balochistan National Party":return"BNP";case"Sindh United Party":return"SUP";case"MUTAHIDA DEENI MAHAZ":return"MDM";case"Pakistan Peoples Party (Shaheed Bhutto)":return"PPP-SB";case"Jamiat Ulama-e-Pakistan (Noorani)":return"JUP-N";case"Tehreek-e-Suba Hazara":return"TSH";case"Pakistan Sunni Tehreek":return"PST";case"Bahawalpur National Awami Party":return"BNA";case"Jumiat Ulma-e-Islam(Nazryati)":return"JUI-N";case"Qomi Awami Tehreek":return"QAT";case"Majlis-e-Wahdat-e-Muslimeen Pakistan":return"MWM";case"Pakistan National Muslim League":case"Pakistan Muslim League (J)":return"PNML";case"Sunni Ittehad Council":return"SIC";case"Sindh Taraqi Passand Party (STP)":return"STP";case"Balochistan National Party (Awami)":return"BNP-A";case"MUTTHIDA MAJLIS-E-AMAL PAKISTAN":return"MMA";default:return"Other"}}d3.select("#vizcontain").selectAll("*").remove(),d3.select("#legendcontain").selectAll("*").remove(),d3.csv("one_one_mapping.csv",function(a,n){function r(e,t){var a=(2013==t?elections_2013:elections_2008).filter(function(t){return t.seat==e})[0];return null!=a?a.results[0].party:null}n.map(function(e){e.party_2008=r(e[2008],2008),e.party_2013=r(e[2013],2013),e.party_2008_abb=t(r(e[2008],2008)),e.party_2013_abb=t(r(e[2013],2013))});var s=(n=n.filter(function(e){return"Other"!=e.party_2008_abb&&"Other"!=e.party_2013_abb})).map(function(e){return e.party_2013_abb}).filter(o);function o(e,t,a){return a.indexOf(e)==t}var d=n.map(function(e){return e.party_2008_abb}).filter(o).concat(s),l=[];(d=d.filter(o)).forEach(function(e){var t=[];d.forEach(function(a){var r=n.filter(function(t){return t.party_2013_abb==e&&t.party_2008_abb==a}).length;t.push(r)}),l.push(t)});var c=d3.select("#vizcontain").append("svg").attr("width",540).attr("height",540).attr("viewBox","0 0 540 540").attr("perserveAspectRatio","xMinYMid").attr("id","chorddiagram").classed("animated",!0).classed("fadeInDefault",!0),i=.5*Math.min(540,540)-50,u=i-15,p=(d3.formatPrefix(",.0",1e3),d3.chord().padAngle(.025).sortSubgroups(d3.ascending)),g=d3.arc().innerRadius(u).outerRadius(i),h=d3.ribbon().radius(u),m=d3.scaleOrdinal(d3.schemeCategory20),y=c.append("g").attr("transform","translate(270,270)").datum(p(l)),f=y.append("g").attr("class","groups").attr("id","chordgroup").selectAll("g").data(function(e){return e.groups}).enter().append("g").attr("class",function(e,t){return d[t]}).classed("party_holders",!0);function v(e){return d3.select(e).style("font-size").replace("px","")/2/(2*i*Math.PI)*360}function x(t,a){return function(n,r){if(d3.select("g.ribbons").selectAll("path").filter(function(e){return e.source.index!==r&&e.target.index!==r}).transition().style("fill-opacity",t).style("stroke-opacity",t),a){if(d3.select("body").append("div").classed("chordtool",!0).classed("animated",!0).classed("fadeIn",!0).attr("id","hoverbox"),d3.event.pageY>window.innerHeight-250){var s=document.getElementById("hoverbox");d3.select(".chordtool").style("top",d3.event.pageY-s.offsetHeight-50+"px"),d3.event.pageX-87.5<0?d3.select(".chordtool").style("left",d3.event.pageX+4+"px"):d3.event.pageX+87.5>window.innerWidth?d3.select(".chordtool").style("left",d3.event.pageX-175+"px"):d3.select(".chordtool").style("left",d3.event.pageX-87.5+"px")}else d3.select(".chordtool").style("top",d3.event.pageY+10+"px"),d3.event.pageX-87.5<0?d3.select(".chordtool").style("left",d3.event.pageX+4+"px"):d3.event.pageX+87.5>window.innerWidth?d3.select(".chordtool").style("left",d3.event.pageX-175+"px"):d3.select(".chordtool").style("left",d3.event.pageX-87.5+"px");d3.select(".chordtool").append("div").classed("party",!0).html(function(){return"<span>"+d[n.index]+" - "+n.value+" seats</span>"}),d3.select(".chordtool").append("div").classed("cpartyicon",!0).html(function(){return e(d[n.index])})}else d3.select(".chordtool").remove()}}function P(t,a,n){return function(r){var s=r;d3.select("g.ribbons").selectAll("path").transition().style("fill-opacity",function(e){return e.source.index===s.source.index&&e.target.index===s.target.index?t:a}).style("stroke-opacity",function(e){return e.source.index===s.source.index&&e.target.index===s.target.index?t:a});var o=d3.select(this).data()[0],l=o.source.value,c=o.target.value;if(n)if(o.source.index==o.target.index){if(d3.select("body").append("div").classed("chordtool",!0).classed("animated",!0).classed("fadeIn",!0).attr("id","hoverbox"),d3.event.pageY>window.innerHeight-250){var i=document.getElementById("hoverbox");d3.select(".chordtool").style("top",d3.event.pageY-i.offsetHeight-50+"px"),d3.event.pageX-87.5<0?d3.select(".chordtool").style("left",d3.event.pageX+4+"px"):d3.event.pageX+87.5>window.innerWidth?d3.select(".chordtool").style("left",d3.event.pageX-175+"px"):d3.select(".chordtool").style("left",d3.event.pageX-87.5+"px")}else d3.select(".chordtool").style("top",d3.event.pageY+10+"px"),d3.event.pageX-87.5<0?d3.select(".chordtool").style("left",d3.event.pageX+4+"px"):d3.event.pageX+87.5>window.innerWidth?d3.select(".chordtool").style("left",d3.event.pageX-175+"px"):d3.select(".chordtool").style("left",d3.event.pageX-87.5+"px");d3.select(".chordtool").append("div").classed("party",!0).html(function(){return'<span style="padding: 2px;">'+d[r.source.index]+" retained "+l+(l>1?" seats":" seat")+"</span>"}),d3.select(".chordtool").append("div").classed("cpartyicon",!0).html(function(){return e(d[r.source.index])})}else{d3.select("body").append("div").classed("chordtoolexpand",!0).classed("animated",!0).classed("fadeIn",!0).attr("id","hoverbox");document.getElementById("chorddiagram").getBoundingClientRect().x,document.getElementById("chorddiagram").getBoundingClientRect().width,document.getElementById("chorddiagram").getBoundingClientRect().width;if(d3.event.pageY>window.innerHeight-250){i=document.getElementById("hoverbox");d3.select(".chordtoolexpand").style("top",d3.event.pageY-i.offsetHeight-130+"px"),d3.event.pageX-125<0?d3.select(".chordtoolexpand").style("left",d3.event.pageX-125-(d3.event.pageX-125)+5+"px"):d3.event.pageX+125>window.innerWidth?d3.select(".chordtoolexpand").style("right","15px"):d3.select(".chordtoolexpand").style("left",d3.event.pageX-125+"px")}else console.log("goodbye"),d3.select(".chordtoolexpand").style("top",d3.event.pageY+10+"px"),d3.event.pageX-125<0?d3.select(".chordtoolexpand").style("left",d3.event.pageX-125-(d3.event.pageX-125)+5+"px"):d3.event.pageX+125>window.innerWidth?d3.select(".chordtoolexpand").style("right","15px"):d3.select(".chordtoolexpand").style("left",d3.event.pageX-125+"px");d3.select(".chordtoolexpand").append("div").classed("cpartyicon",!0).classed("vsparty",!0).attr("id","winnericon").html(function(){return e(d[r.source.index])}),setTimeout(function(){$("#winnericon").css("padding","4px")},100),d3.select(".chordtoolexpand").append("div").classed("chordtoolheading",!0).html(function(){return"<span>Flow between "+d[r.source.index]+" & "+d[r.target.index]+"</span>"}),d3.select(".chordtoolexpand").append("div").classed("cpartyicon",!0).classed("vsparty",!0).html(function(){return e(d[r.target.index])}),d3.select(".chordtoolexpand").append("div").classed("chordexpandicon",!0).html(function(){return'<img src="./resources/up-chevron-button.svg" style="width: 100%;">'}),d3.select(".chordtoolexpand").append("div").classed("chordexpandinfo",!0).html(function(){return"<span>"+d[r.source.index]+" gained "+l+(l>1?" seats":" seat")+" from "+d[r.target.index]+"</span>"}),d3.select(".chordtoolexpand").append("div").classed("chordexpandicon",!0).html(function(){return'<img src="./resources/chevron-sign-down.svg" style="width: 100%;">'}),d3.select(".chordtoolexpand").append("div").classed("chordexpandinfo",!0).html(function(){return"<span>"+d[r.source.index]+" lost "+c+(c>1?" seats":" seat")+" to "+d[r.target.index]+"</span>"})}else d3.select(".chordtool").remove(),d3.select(".chordtoolexpand").remove()}}f.append("text").each(function(e){e.angle=(e.startAngle+e.endAngle)/2}).text(function(e,t){return d[t]}).classed("party_label",!0).attr("transform",function(e,t){return"rotate("+(e.angle/2*(360/Math.PI)-90)+")rotate("+(e.angle>Math.PI?-v(".party_label"):v(".party_label"))+")translate("+(i+10)+") "+(e.angle>Math.PI?"rotate(180)":"")}).attr("text-anchor",function(e){return e.angle>Math.PI?"end":null}),f.append("path").style("fill",function(e){return m(e.index)}).style("stroke",function(e){return d3.rgb(m(e.index)).darker()}).attr("d",g),y.append("g").attr("class","ribbons").selectAll("path").data(function(e){return e}).enter().append("path").attr("d",h).style("fill",function(e){return m(e.source.index)}).style("stroke",function(e){return d3.rgb(m(e.source.index)).darker()}).style("fill-opacity",.7).style("stroke-opacity",.7),d3.selectAll(".party_holders").on("mouseover",x(.05,1)).on("mouseout",x(.7,0)),d3.select("g.ribbons").selectAll("path").on("mouseover",P(.7,0,1)).on("mouseout",P(.7,.7,0))})}
