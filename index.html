<!DOCTYPE html>
<meta name="robots" content="noindex">
<html>
  <head>
    <link rel="icon" href="./resources/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="./resources/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.min.js"></script>
    <script src="socket.io.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Elections | Plotree Info Design</title>
    <link rel="stylesheet" type="text/css" href="animate.css">
    <link rel="stylesheet" type="text/css" href="index.css">
    <link rel="stylesheet" type="text/css" href="./ionrange/ion.rangeSlider.css">
    <link rel="stylesheet" type="text/css" href="./ionrange/ion.rangeSlider.skinNice.css">
  </head>
  <body>
    <div class='applicationWrap' onclick="void(0)">

    <nav class="navbar navbar-expand-lg navbar-dark nav18">
      <div class="container">
        <div>
          <img class="navbar-brand logo plotreeweb" id="plotreelogo" src="./resources/logo.svg"></img>
        </div>

        <ul class="navbar-nav electionbuttcontain">
          <li class="nav-item">
            <div style="display: flex">
              <img class="ballothome" src="./resources/ballot2.svg"></img>
              <span id="past" class="electlink" style="margin-right: 20px; align-self: center; margin-left: 5px;">PAST ELECTIONS</span>
            </div>
          </li>
          <li class="nav-item">
            <div style="display: flex">
              <img class="ballothome" src="./resources/ballot3.svg"></img>
              <span id="2018" year="2018" class="electlink" style="align-self: center; margin-left: 5px;">ELECTION 2018</span>
            </div>
          </li>
          <li class="nav-item socialicons">
            <div style="display: flex; align-items: center; height: 100%; color: #57068c; font-size: 20px;">
              <i style="margin-right: 10px; margin-left: 20px;" class="fab fa-twitter socicon plotreetwitter"></i>
              <i class="fab fa-linkedin-in socicon plotreelinkedin"></i>
            </div>
          </li>
        </ul>
      </div>
    </nav>

    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12" style="display: flex; flex-direction: column; align-items: center">
      <div style="display: flex; height: 125px;">
        <img class="liveBallot" src="./resources/ballot3.svg"></img>
        <span class="liveTitle" style="margin-right: 20px; align-self: center; margin-left: 5px; font-family: 'Lato', sans-serif; font-weight: 300">PAKISTAN ELECTIONS 2018</span>
      </div>
    </div>

    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12" style="display: flex; flex-direction: column; align-items: center; margin-bottom: 25px;">
      <div style="display: flex;">
        <span class="naTitle" style="margin-right: 20px; align-self: center; margin-left: 5px; font-family: 'Lato', sans-serif; font-weight: 300">NATIONAL ASSEMBLY RESULTS</span>
      </div>
    </div>

    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 vizbuttonscontainer" id="filterdropdown" style="margin-bottom: 10px; margin-top: -5px; z-index: 9">
      <div class="dropdown">
        <a class="btn btn-primary dropdown-toggle filterbutton" style="border-top-right-radius: 0px; border-bottom-right-radius: 0px; border: 0px;" href="#" role="button" id="dropdownFilterLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Filter
        </a>

        <div class="dropdown-menu" aria-labelledby="dropdownFilterLink">
          <a class="dropdown-item filteritem" id="partyfilterbutt" style="cursor: pointer;">Party</a>
          <a class="dropdown-item filteritem" id="provincefilterbutt" style="cursor: pointer;">Province</a>
          <a class="dropdown-item filteritem" id="votemarginbutt" style="cursor: pointer;">Vote Margin</a>
          <a class="dropdown-item filteritem" id="runnerupbutt" style="cursor: pointer;">Runner Up</a>
          <a class="dropdown-item filteritem" id="voteturnoutbutt" style="cursor: pointer;">Vote Turnout</a>
          <a class="dropdown-item filteritem" id="seatbutt" style="cursor: pointer;">Seat</a>
        </div>
      </div>

      <button type="button" class="btn btn-primary filterbutton" id="resetAll" style="border-top-left-radius: 0px; border-bottom-left-radius: 0px; border: 0px;">Reset</button>
    </div>
    <div class="filterscontstantheight">
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 filtercontainer" id="partyFilters">
        <div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partyfilter" value="Pakistan Tehreek-e-Insaf" active="disabled" id="PTIfilter">
            <label class="form-check-label" for="PTIfilter">PTI</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partyfilter" value="Pakistan Muslim League (N)" active="disabled" id="PMLNfilter">
            <label class="form-check-label" for="PMLNfilter">PMLN</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partyfilter" value="Muttahida Majlis-e-Amal" active="disabled" id="MMAfilter">
            <label class="form-check-label" for="MMAfilter">MMA</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partyfilter" value="Pakistan Muslim League" active="disabled" id="PMLfilter">
            <label class="form-check-label" for="INDfilter">PML</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partycheck" toggleClass="disabled" value="null" id="PSPfilter">
            <label class="form-check-label" for="PSPfilter">PSP</label>
          </div>
        </div>
        <div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partyfilter" value="Pakistan Peoples Party Parliamentarians" active="disabled" id="PPPPfilter">
            <label class="form-check-label" for="PMLfilter">PPPP</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partyfilter" value="Independent" active="disabled" id="Indfilter">
            <label class="form-check-label" for="PPPPfilter">Ind.</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partyfilter" value="Grand Democratic Alliance" active="disabled" id="GDAfilter">
            <label class="form-check-label" for="GDAfilter">GDA</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partyfilter" value="Muttahida Qaumi Movement Pakistan" active="disabled" id="MQMfilter">
            <label class="form-check-label" for="MQMfilter">MQM</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input partyfilter" value="Rest" active="disabled" id="Restfilter">
            <label class="form-check-label" for="Restfilter">Other</label>
          </div>
        </div>
      </div>

      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 filtercontainer" id="provinceFilters">
        <div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input provincecheck" toggleClass="provinceDisabled" id="displayAll">
            <label class="form-check-label" for="displayAll">All</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input provincefilter" value="Punjab" active="disabled" id="PUNfilter">
            <label class="form-check-label" for="PUNfilter">Punjab</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input provincefilter" value="Sindh" active="disabled" id="SNDfilter">
            <label class="form-check-label" for="SNDfilter">Sindh</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input provincefilter" value="FATA" active="disabled" id="FATAfilter">
            <label class="form-check-label" for="FATAfilter">FATA</label>
          </div>
        </div>
        <div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input provincefilter" value="Balochistan" active="disabled" id="BALfilter">
            <label class="form-check-label" for="BALfilter">Balochistan</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input provincefilter" active="disabled" value="KP" id="KPKfilter">
            <label class="form-check-label" for="KPKfilter">KPK</label>
          </div>
          <div class="form-group form-check form-check-inline">
            <input type="checkbox" class="form-check-input provincefilter" value="ICT" active="disabled" id="ICTfilter">
            <label class="form-check-label" for="ICTfilter">ICT</label>
          </div>
        </div>
      </div>

      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 filtercontainer" id="rangeFilters">
        <div style="width: 275px">
          <input type="text" id="voteMargin" name="vote_margin" value="" />
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 filtercontainer" id="rangeFiltersTurnout">
        <div style="width: 275px">
          <input type="text" id="voteTurnout" name="vote_turnout" value="" />
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 filtercontainer" id="rangeFiltersSeat">
        <div style="width: 275px">
          <input type="text" id="naSeat" name="na_seat" value="" />
        </div>
      </div>
    </div>

    <div class='container-18'>
      <div class="col-sm-12 col-md-12 col-lg-9 col-xl-9 viz" id="viz2018">
        <div>
          <div style="max-width: 750px; margin-left: auto; margin-right: auto;">
            <div class="container" id="vizcontain">
            </div>
          </div>
        </div>
        <div class="container" id="legendcontain">
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-3 col-xl-3" id="update2018">
        <p style="font-family: 'Lato', sans-serif; font-weight: 300; font-size: 18px; margin-top: 15px;">LATEST UPDATES</p>
        <div class="timeupdates" style="display: flex; flex-direction: column-reverse">

        </div>
      </div>
    </div>
    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 leadTitle">
        <img class="liveBallot" style="width: 50px; margin-top: 30px;" src="./resources/ballot3.svg"></img>
        <p style="margin-left: 5px; margin-bottom: 0px; margin-top: 30px;">CURRENTLY LEADING</p>
    </div>
    <div class="container-18" id="firstLeadRow">
      <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6 leaders-18" id="firstparty">
      </div>
      <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6 leaders-18" id="secondparty">
      </div>
    </div>
    <div class="container-18" id="secondLeadRow">
      <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6 leaders-18" id="thirdparty">
      </div>
    </div>

    <footer id="footer" style="width: 100%; background: #0D47A1;">
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
        <div style="display: flex; justify-content: center;" class="container">
          <img style="width: 100px; height: 100px;" src="./resources/ballotfoot2.svg"></img>
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 footercol" style="margin-top: 20px;">
        <div style="display: flex; flex-direction: column; color: white; font-size: 14px;" class="container">
          <p class="plotreename" style="margin-bottom: 0px;">Designed and developed by <span class="footlink plotreeweb">Plotree Info Design</span> © 2018</p>
       </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 footercol" style="margin-top: 20px;">
        <div style="display: flex; flex-direction: column; color: white; font-size: 14px;" class="container">
          <p class="footerdesc" style="margin-bottom: 0px; align-self: center;">Plotree is an information design studio based in Lahore. We help organizations communicate insights underlying their data through interactive web based visualizations. Get in touch and collaborate with us to bring your data to life on your websites, publications or presentations.</p>
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 footercol" style="margin-top: 20px;">
        <div style="display: flex; flex-direction: column; color: white; font-size: 14px;" class="container">
          <p class="footerdesc" style="margin-bottom: 0px; align-self: center; color: #FFEB3B;'">Note: In this tool, vote margin is defined as the vote percentage of the runner up subtracted from the vote percentage of the winner.</p>
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 footercol" style="margin-top: 20px;">
        <div style="display: flex; flex-direction: column; color: white; font-size: 14px;" class="container">
          <p class="footerdesc" style="margin-bottom: 0px; align-self: center; color: #F57C00;'">Note: Legends do not scale for smaller screen devices.</p>
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12" style="margin-top: 20px;">
        <div style="display: flex; justify-content: center; color: white; font-size: 14px;" class="container">
          <i style="font-size: 20px" class="fas fa-link footsocicon plotreeweb"></i>
          <i style="font-size: 20px; margin-right: 15px; margin-left: 15px;" class="fab fa-twitter footsocicon plotreetwitter"></i>
          <i style="font-size: 20px" class="fab fa-linkedin-in footsocicon plotreelinkedin"></i>
        </div>
      </div>
    </footer>
  </div>

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="./ionrange/ion.rangeSlider.min.js"></script>
    <script async src="./essentials/elections_2018.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="./essentials/utils.js"></script>
    <script src="./essentials/liveResults.js"></script>
    <script src="./es6/bar.js"></script>
    <script src="./es6/namap_2018.js"></script>

    <script async src="./es6/filterNAmap.js"></script>

    <script>

      var electionYear = 2013;
      var nationalFilter = true;
      $("#filterdropdown").hide();
      $("#2018").css('color', '#1976D2');

      $('#past').click(function(){
        window.location = "./pastelections.html";
      })

      $(window).on('load', function() {
        createNAMap_2018("init");
      })

      $("#naSeat").ionRangeSlider({
          type: "double",
          grid: true,
          min: 1,
          max: 272,
          from: 1,
          to: 272,
          prefix: "NA "
      });

      $(".plotreelinkedin").click(function() {
        window.open('https://www.linkedin.com/company/plotree/', '_blank');
      });

      $(".plotreetwitter").click(function() {
        window.open('https://twitter.com/plotreeViz', '_blank');
      });

      $(".plotreeweb").click(function() {
        window.open('https://plotree.studio/', '_blank');
      });

      $("#partyfilterbutt").click(function() {
        $("#partyFilters").show().addClass('animated fadeInDefault').css('display', 'flex');
        $("#provinceFilters").hide();
        $('#rangeFilters').hide();
      });

      $("#runnerupbutt").click(function() {
        $("#runnerUpPartyFilters").show().addClass('animated fadeInDefault').css('display', 'flex');
        $("#provinceFilters").hide();
        $('#rangeFilters').hide();
        $("#partyFilters").hide();
        $('#rangeFiltersTurnout').hide();
        $('#rangeFiltersSeat').hide();
      });

      $("#provincefilterbutt").click(function() {
        $("#provinceFilters").show().addClass('animated fadeInDefault').css('display', 'flex');
        $("#partyFilters").hide();
        $('#rangeFilters').hide()
      });

      $("#votemarginbutt").click(function() {
        $("#provinceFilters").hide();
        $("#partyFilters").hide();
        $('#rangeFilters').show().addClass('animated fadeInDefault').css('display', 'flex');
      });

      $("#voteturnoutbutt").click(function() {
        $("#provinceFilters").hide();
        $("#partyFilters").hide();
        $("#runnerUpPartyFilters").hide();
        $('#rangeFilters').hide();
        $('#rangeFiltersTurnout').show().addClass('animated fadeInDefault').css('display', 'flex');
        $('#rangeFiltersSeat').hide();
      });

      $("#seatbutt").click(function() {
        $("#provinceFilters").hide();
        $("#partyFilters").hide();
        $("#runnerUpPartyFilters").hide();
        $('#rangeFilters').hide();
        $('#rangeFiltersTurnout').hide();
        $('#rangeFiltersSeat').show().addClass('animated fadeInDefault').css('display', 'flex');
      });

      //Filter functions follow

      //variables so filterNAmap is only called once
      var parties = [];
      var runupparties = [];
      var provinces = [];
      var margin = [];
      var turnout = [];
      var seats = [];
      var selectedProvince = ["KP"];

      //For each partyfilter classed element, this function checks its active prop. In case the button is selected, it sets it to active and pushes the party, else it removes party
      $('.partyfilter').change(function() {
        var isActive = $(this).attr("active");
        if(isActive === "disabled") {
          this.setAttribute("active", "active");
          parties.push($(this).attr("value"));
          $('#displayAll').prop('checked', false);
          $('#displayAll').attr("toggleClass", "disabled")
        }
        else {
          this.setAttribute("active", "disabled");
          var index = parties.indexOf($(this).attr("value"));
          if (index >= 0) {
            parties.splice(index, 1);
          }
        }
      })

      $('.runneruppartyfilter').change(function() {
        var isActive = $(this).attr("active");
        if(isActive === "disabled") {
          this.setAttribute("active", "active");
          runupparties.push($(this).attr("value"));
          $('#displayAllrunup').prop('checked', false);
          $('#displayAllrunup').attr("toggleClass", "disabled")
        }
        else {
          this.setAttribute("active", "disabled");
          var index = runupparties.indexOf($(this).attr("value"));
          if (index >= 0) {
            runupparties.splice(index, 1);
          }
        }
      })

      $('.provincefilter').change(function() {
        var isActive = $(this).attr("active");
        if(isActive === "disabled") {
          this.setAttribute("active", "active");
          provinces.push($(this).attr("value"));
          $('.provincecheck').prop('checked', false);
          $('.provincecheck').attr("toggleClass", "provinceDisabled");
        }
        else {
          this.setAttribute("active", "disabled");
          var index = provinces.indexOf($(this).attr("value"));
          if (index >= 0) {
            provinces.splice(index, 1);
          }
        }
      })

      $('.partycheck').change(function() {
        var toggleValue = $(this).attr("toggleClass")
        if(toggleValue === "disabled") {
          this.setAttribute("toggleClass", "active")
          $('.partyfilter').attr("active", "disabled");
          $('.partyfilter').prop('checked', false);
          parties = [];
        }
        else {
          this.setAttribute("toggleClass", "disabled")
          $('.partyfilter').attr("disabled", false);
        }
      })

      $('.partycheckrun').change(function() {
        var toggleValue = $(this).attr("toggleClass")
        if(toggleValue === "disabled") {
          this.setAttribute("toggleClass", "active")
          $('.runneruppartyfilter').attr("active", "disabled");
          $('.runneruppartyfilter').prop('checked', false);
          runupparties = [];
        }
        else {
          this.setAttribute("toggleClass", "disabled")
          $('.runneruppartyfilter').attr("disabled", false);
        }
      })

      $('.provincecheck').change(function() {
        var toggleValue = $(this).attr("toggleClass")
        if(toggleValue === "provinceDisabled") {
          this.setAttribute("toggleClass", "active")
          $('.provincefilter').attr("active", "disabled");
          $('.provincefilter').prop('checked', false);
          provinces = [];
        }
        else {
          this.setAttribute("toggleClass", "provinceDisabled")
          $('.provincefilter').attr("disabled", false);
        }
      })

      $("#voteMargin").ionRangeSlider({
          type: "double",
          grid: true,
          min: 0,
          max: 100,
          from: 0,
          to: 100,
          postfix: " %"
      });

      $("#voteTurnout").ionRangeSlider({
          type: "double",
          grid: true,
          min: 0,
          max: 100,
          from: 0,
          to: 100,
          postfix: " %"
      });

      margin.push($("#voteMargin").data("ionRangeSlider").result.from);
      margin.push($("#voteMargin").data("ionRangeSlider").result.to);

      $('#voteMargin, input:checkbox').change(function() {
        // Saving Ion range instance to var
        var slider = $("#voteMargin").data("ionRangeSlider");
        // Get values
        var from = slider.result.from;
        var to = slider.result.to;
        margin[0] = from;
        margin[1] = to;
        if (nationalFilter === true) {
          if (provinces.length == 0 && parties.length == 0) {
            filterCircles(null, null, margin);
          }
          else if (provinces.length == 0 && parties.length > 0) {
            filterCircles(null, parties, margin);
          }
          else if (parties.length == 0 && provinces.length > 0) {
            filterCircles(provinces, null, margin);
          }
          else {
            filterCircles(provinces, parties, margin);
          }
        }
        if (nationalFilter === false) {
          if (parties.length === 0) {
            filterCirclesPr(selectedProvince, null, margin);
          }
          else {
            filterCirclesPr(selectedProvince, parties, margin);
          }
        }
      });


      $("#resetAll, #NA, .PA, .dwvs, #flow, .provinceButt, .electlink").click(function() {
        if (nationalFilter === true) {
          filterCircles(null, null, null);
        }
        else {
          filterCirclesPr(selectedProvince, null, null);
        }
        $('.provincefilter').attr("active", "disabled");
        $('.provincefilter').prop('checked', false);
        provinces = [];
        $('.partyfilter').attr("active", "disabled");
        $('.partyfilter').prop('checked', false);
        parties = [];
        $('.provincecheck').prop('checked', false);
        $('.provincecheck').attr("toggleClass", "provinceDisabled");
        $('#displayAll').prop('checked', false);
        $('#displayAll').attr("toggleClass", "disabled")
        $("#voteMargin").data("ionRangeSlider").reset();
        margin = [];
      });


    </script>

  </body>
</html>
