"use strict";function createNAMap(){d3.select("#vizcontain").selectAll("*").remove(),d3.select("#legendcontain").selectAll("*").remove(),function(){var t=d3.select("#vizcontain"),e=d3.geoMercator().center([75,31.5]).scale([1950]),a=d3.geoPath().projection(e),n=t.append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 636 600").style("fill-opacity",1).classed("map_in_a_box","true").attr("id","NAmap"),r=n.append("g").classed("map_group","true");d3.queue().defer(d3.json,"pakistan_districts.topojson").defer(d3.json,"JAndKashmir.topojson").defer(d3.json,"Pak_prov.topojson").defer(d3.json,"Pakistan_NationalBoundary.topojson").defer(d3.csv,"NA_seats_2013.csv").await(function(t,e,s,i,o,c){var d=topojson.feature(e,e.objects.pakistan_districts).features,p=topojson.feature(s,s.objects.JAndKashmir).features,u=topojson.feature(i,i.objects.Pak_prov).features,f=topojson.feature(o,o.objects.Pakistan_NationalBoundary).features,m=d.map(function(t){var e=t.properties.districts,n={};return n.district=e,n.centroid=a.centroid(t),n});r.selectAll("path").data(d).enter().append("path").attr("d",function(t,e){return a(t)}).style("stroke","#FFF").style("stroke-width",.25).style("fill","#FFF").style("fill-opacity",.9).attr("class",function(t,e){return t.properties.districts}).classed("district",!0),r.selectAll(".Kashmir").data(p).enter().append("path").classed("Kashmir",!0).attr("d",function(t,e){return a(t)}).style("fill-opacity",1).style("stroke","grey").style("stroke-dasharray",2).style("stroke-width",.5).style("fill","#FFF"),r.selectAll(".Pak_boundary").data(f).enter().append("path").classed("Pakistan",!0).attr("d",function(t,e){return a(t)}).style("stroke","grey").style("stroke-width",1).style("fill","white").style("fill-opacity",.9),r.selectAll(".Pak_prov").data(u).enter().append("path").classed("PakProv",!0).attr("d",function(t,e){return a(t)}).style("stroke","grey").style("stroke-width",0).style("fill","white").style("fill-opacity",.9);var y=join(c,elections_2013,"Seat","seat",function(t,e){return{seat:e.Seat,PrimaryDistrict:e.PrimaryDistrict,SeconDistrict:e.SeconDistrict,Province:e.Province,"Percentage of Votes Polled to Registered Voters":t["Percentage of Votes Polled to Registered Voters"],"Registered Votes":t["Registered Votes"],"Rejected Votes":t["Rejected Votes"],"Valid Votes":t["Valid Votes"],"Votes Polled":t["Votes Polled"],results:t.results}});y.forEach(function(t){t.voteMargin=100*(t.results[0].votes/t["Valid Votes"]-t.results[1].votes/t["Valid Votes"]),t.radius=3+t.voteMargin/100*5,t.radiusInit=3+t.voteMargin/100*5}),y.forEach(function(t){t.x=A(t.PrimaryDistrict)[0],t.y=A(t.PrimaryDistrict)[1]});var h=y,v=(d3.forceSimulation(h).force("charge",d3.forceManyBody().strength(.7)).force("x",d3.forceX().x(function(t){return A(t.PrimaryDistrict)[0]})).force("y",d3.forceY().y(function(t){return A(t.PrimaryDistrict)[1]})).force("collision",d3.forceCollide().radius(function(t){return t.radius+.8})).on("tick",function(){d3.selectAll(".naSeatCircle").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),d3.select("svg").selectAll(".circle-catcher.NAmap").data(h).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}).alpha(.525).alphaDecay(.07).on("end",function(){P=P.data(g.polygons(h)).call(k)}),n.append("g").classed("na-seats-group",!0).selectAll(".naSeat").data(h));v.enter().append("g").attr("class",function(t){return t.seat}).classed("naSeat_g",!0).append("circle").attr("class","naSeatCircle").classed("2013",!0).classed("namap",!0).merge(v).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).style("fill",function(t){return l(t.results[0].party)}).attr("party",function(t){return t.results[0].party}).attr("id",function(t){return t.seat}).attr("r",0).transition("bubble_up").duration(1e3).ease(d3.easePoly).attr("r",function(t){return 3+t.voteMargin/100*5}),v.exit().remove();var g=d3.voronoi().x(function(t){return t.x+randRange(-1,1)}).y(function(t){return t.y+randRange(-1,1)}).extent([[0,0],[width,height]]),P=n.append("defs").selectAll(".clip.NAmap").data(g.polygons(h)).enter().append("clipPath").attr("class","clip NAmap").attr("id",function(t){return null!=t?"clipNAmap"+t.data.seat:"clipNAmapNA"}).append("path").attr("class","clip-path-circle NAmap").call(k);function k(t){t.attr("d",function(t){return t?"M"+t.join(",")+"Z":null})}function A(t){return m.filter(function(e){return e.district==t})[0].centroid}n.append("g").classed("clip-circles",!0).classed("NAmap",!0).selectAll(".circle-catcher").data(h).enter().append("circle").attr("class",function(t,e){return"circle-catcher NAmap "+t.seat}).attr("clip-path",function(t,e){return"url(#clipNAmap"+t.seat+")"}).style("clip-path",function(t,e){return"url(#clipNAmap"+t.seat+")"}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",20).style("fill","none").style("pointer-events","all"),d3.selectAll("circle.circle-catcher.NAmap").on("mouseover",function(t,e){var a=d3.select(this).attr("class").replace("circle-catcher NAmap ",""),n=d3.select("g."+a),r=n.select("circle");n.raise(),r.transition().ease(d3.easeElastic).duration(1700).tween("radius",function(t){var e=d3.select(this),a=d3.interpolate(t.radius,10);return function(n){t.radius=a(n),e.attr("r",function(t){return t.radius})}}).attr("fill",function(t){return d3.rgb(l(t.results[0].party)).darker()}).attr("stroke",function(t){return d3.rgb(l(t.results[0].party)).darker()}).attr("stroke-width",2);var s=r.data()[0],i=l(s.results[0].party);d3.select("body").append("div").classed("animated",!0).classed("zoomIn",!0).classed("tool",!0).attr("id","hoverbox");var o=d3.select(".tool");if(o.append("div").classed("toolhead",!0).html(function(t){return'<span class="NA">'+s.seat+' </span><span class="turnout">('+s["Percentage of Votes Polled to Registered Voters"]+"% voter turnout)</span>"}),o.append("div").classed("partyicon",!0).html(image(s.results[0].party)),o.append("div").classed("toolhead",!0).html(function(t){return'<span class="dist">District: </span><span class="turnout">'+s.PrimaryDistrict+"</span>"}),o.append("div").classed("nametitle",!0).html(function(t){return"<span>Name</span>"}),o.append("div").classed("partytitle",!0).html(function(t){return"<span>Party</span>"}),o.append("div").classed("voteTitle",!0).html(function(t){return"<span>Votes</span>"}),o.append("div").classed("partyColorToolBar",!0).style("background-color",i),o.append("div").classed("candidatename",!0).html(function(t){return"<span>"+titleCase(s.results[0].candidate)+"</span>"}),o.append("div").classed("partyname",!0).html(function(t){return"<span>"+abbreviate(s.results[0].party)+"</span>"}),o.append("div").classed("votes",!0).html(function(t){return"<span>"+s.results[0].votes+"</span>"}),o.append("div").classed("candidatename",!0).html(function(t){return"<span>"+titleCase(s.results[1].candidate)+"</span>"}),o.append("div").classed("partyname",!0).html(function(t){return"<span>"+abbreviate(s.results[1].party)+"</span>"}),o.append("div").classed("votes",!0).html(function(t){return"<span>"+s.results[1].votes+"</span>"}),o.append("div").classed("candidatename",!0).html(function(t){return'<span class="mobiletoolremove">'+titleCase(s.results[2].candidate)+"</span>"}),o.append("div").classed("partyname",!0).html(function(t){return'<span class="mobiletoolremove">'+abbreviate(s.results[2].party)+"</span>"}),o.append("div").classed("votes",!0).html(function(t){return'<span class="mobiletoolremove">'+s.results[2].votes+"</span>"}),d3.event.pageY>=460){var c=document.getElementById("hoverbox");o.style("top",d3.event.pageY-c.offsetHeight-18+"px"),d3.event.pageX-125<0?o.style("left",window.innerWidth/2-125+"px"):d3.event.pageX+125>window.innerWidth?o.style("left",window.innerWidth/2-125+"px"):window.innerWidth<450?o.style("left",window.innerWidth/2-125+"px"):o.style("left",d3.event.pageX-125+"px")}else o.style("top",d3.event.pageY+14+"px"),d3.event.pageX-125<0?o.style("left",window.innerWidth/2-125+"px"):d3.event.pageX+125>window.innerWidth?o.style("left",window.innerWidth/2-125+"px"):window.innerWidth<450?o.style("left",window.innerWidth/2-125+"px"):o.style("left",d3.event.pageX-125+"px")}).on("mouseout",function(t,e){var a=d3.select(this).attr("class").replace("circle-catcher NAmap ","");d3.select("circle#"+a).transition().ease(d3.easeElastic).duration(1200).tween("radius",function(t){var e=d3.select(this),a=d3.interpolate(t.radius,t.radiusInit);return function(n){t.radius=a(n),e.attr("r",function(t){return t.radius>=0?t.radius:0})}}).attr("fill",function(t){return l(t.results[0].party)}).attr("stroke",function(t){d3.rgb(l(t.results[0].party))}).attr("stroke-width",0),d3.selectAll(".tool").remove()}),c.map(function(t){t.SeconDistrict=""==t.SeconDistrict?[]:t.SeconDistrict.split(" - ")}),y.map(function(t){return t.results[0].party}).filter(function(t,e,a){return a.indexOf(t)===e});var w=["Pakistan Tehreek-e-Insaf","Jamiat Ulama-e-Islam (F)","Pakistan Muslim League (N)","Independent","Pakistan Muslim League","Pakistan Peoples Party Parliamentarians","Pakistan Muslim League (F)","Muttahida Qaumi Movement Pakistan","Other"],x=w.map(function(t){return"Other"!=t?abbreviate(t):"Rest"}),V=w.map(function(t){return"Other"!=t?l(t):"#03A9F4"}),b=d3.scaleOrdinal().domain(x).range(V),M=d3.select("#legendcontain").append("div").classed("partyLegendSVGDiv",!0);M.append("p").text("Political Party").style("font-size","12px").style("text-align","center").style("margin-bottom","-10px");var N=M.append("svg").classed("partyLegendSVG",!0).attr("width",280).attr("height",50);N.append("g").attr("class","legendOrdinal").attr("transform","translate(20,20)");var D=d3.legendColor().shapePadding(3).shapeWidth(25).shapeHeight(10).scale(b).orient("horizontal");N.select(".legendOrdinal").call(D);var S=d3.select("#legendcontain").append("div").classed("VMLegendSVGDiv",!0);S.append("p").text("Vote Margin").style("font-size","12px").style("text-align","center").style("margin-bottom","-10px");var j=S.append("svg").classed("VMLegendSVG",!0).attr("width",170).attr("height",50),F=(_=[0,25,50,75,100]).map(function(t){return getCircleSize(t)}),_=_.map(function(t){return t+"%"}),L=d3.scaleOrdinal().domain(_).range(F);j.append("g").attr("class","legendSize").attr("transform","translate(25, 20)");var C=d3.legendSize().scale(L).shape("circle").shapePadding(20).labelOffset(15).orient("horizontal");j.select(".legendSize").call(C),d3.selectAll(".VMLegendSVG text").style("font-size",9),d3.selectAll(".VMLegendSVG circle").style("fill","none").style("stroke","black")});var s="#03A9F4",i=["#9C27B0","#4DB6AC",s,s,s,"#81C784","#CDDC39",s,s,s,"#4DD0E1",s,"#607D8B",s,"#FF8A65","#BDBDBD",s,s,s],l=d3.scaleOrdinal().domain(["Pakistan Tehreek-e-Insaf","Jamiat Ulama-e-Islam (F)","Qaumi Watan Party (Sherpao)","Awami National Party","Awami Jamhuri Ittehad Pakistan","Pakistan Muslim League (N)","Independent","Jamaat-e-Islami Pakistan","All Pakistan Muslim League","Awami Muslim League Pakistan","Pakistan Muslim League","Pakistan Muslim League(Z)","Pakistan Peoples Party Parliamentarians","National Peoples Party","Pakistan Muslim League (F)","Muttahida Qaumi Movement Pakistan","Pashtoonkhwa Milli Awami Party","National Party","Balochistan National Party"]).range(i)}()}
